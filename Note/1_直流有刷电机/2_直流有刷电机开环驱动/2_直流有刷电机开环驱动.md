# STM32 电机驱动 2_直流有刷电机开环驱动

直流有刷电机（Brushed DC motor）具有结构简单、易于控制、成本低等特点， 在一些功能简单的应用场合，或者说在能够满足必要的性能、低成本和足够的可靠性的前提下， 直流有刷电机往往是一个很好的选择。

直流有刷电机转速快、扭矩小，在某些应用中可能无法满足要求。这种情况就需要做一些改进来降低转速，并提高力矩。

**齿轮减速电机**在普通直流有刷电机的基础上增加了一套齿轮减速箱， 用来提供更大的力矩和更低的转速。齿轮减速箱可以通过配置不同的减速比，提供各种不同的转速和力矩。

## 1. 直流有刷电机硬件驱动

### 直流有刷电机工作原理

- BDC 的结构

直流有刷电机结构包含：**定子，转子，电刷和换向器**。

> 定子：产生固定的磁场。
>
> 转子：由一个或者多个绕组组成线圈，通电后在磁场中受力运动。
>
> 电刷：将外部电流输入到转子的绕组上。
>
> 换向器：改变电流的流向。

![NULL](picture_1.jpg)

- BDC的工作原理

![NULL](picture_2.jpg)

C和D两片半圆周的铜片构成换向器，两个弹性铜片靠在换向器两侧的A和B是电刷，电源通过电刷向导线框供电， 线框中就有电流通过，在线框两侧放一对磁极N和S，形成磁场，磁力线由N到S。

线框通有电流时， 两侧导线就会受到磁场的作用力，方向依左手定则判断，红色和蓝色线框部分分别会受到力$F_1$和$F_2$， 这两个力的方向相反，这使得线框会转动。

当线框转过90°时，换向器改变了线框电流的方向，产生的安培力方向不变， 于是导线框会连续旋转下去，这就是直流电动机的工作原理。

### H桥驱动电路

- 基本H桥电路

![NULL](picture_3.jpg)

H桥驱动电路包括4个三极管和一个电机。要使电机运转，必须导通对角线上的一对三极管。 根据不同三极管对的导通情况，电流可能会从左至右或从右至左流过电机，从而控制电机的转向。

> 当Q1和Q4导通时，电流将经过Q1从左往右流过电机， 再经过Q4流到电源负极，电机可以顺时针转动。
>
> 当Q3和Q2导通时，电流将经过Q3从右往左流过电机， 再经过Q2流到电源负极，电机可以逆时针转动。

> 特别地，当同一侧的Q1和Q2同时导通时，电流将从电源先后经过Q1和Q2，然后直接流到电源负极， 在这个回路中除了三极管以外就没有其他负载（没有经过电机），这时电流可能会达到最大值，此时可能会烧毁三极管

- 使能/逻辑控制H桥电路

![NULL](picture_4.jpg)

与改进前的电路相比，在上面的改进电路中新增加了两个非门和4个与门， 经过这样的组合就可以实现一个信号控制两个同一侧的三极管， 并且可以保证在同一侧中两个三级管不会同时导通在同一时刻只会有一个三极管是导通的。

### 驱动芯片(L298N/TB6612)

L298N是ST公司的产品，内部包含4通道逻辑驱动电路，是一种二相和四相电机的专门驱动芯片， 即内含两个H桥的高电压大电流双桥式驱动器，接收标准的TTL逻辑电平信号，可驱动4.5 V~46 V、 2A以下的电机，电流峰值输出可达3A。

![NULL](picture_5.jpg)

| IN1  | IN2  | ENA  | 电机状态 |
| ---- | ---- | ---- | -------- |
| ×    | ×    | 0    | 电机停止 |
| 1    | 0    | 1    | 电机正转 |
| 0    | 1    | 1    | 电机反转 |
| 0    | 0    | 1    | 电机停止 |
| 1    | 1    | 1    | 电机停止 |

## 2. PWM 控制

脉冲宽度调制（Pulse width modulation，PWM）信号，按一定的规则对脉冲的宽度进行调制， 既可改变电路输出电压的大小，也可改变输出频率。

PWM通过一定的频率下改变通电和断电的时间从而控制输出脉冲的占空比，从而实现模拟量的输出。

![NULL](picture_6.jpg)

$T_1$为高电平时间，$T_2$为低电平时间，$T$为PWM周期。

占空比公式：
$$
\eta = \frac{T_1}{T} \times 100\%
$$
在低频条件下，可以看到明显的高低电平变化；通常为实现模拟量输出，使用高频PWM信号，使得在宏观时间内高频率的高低电平变化等效为一个介于0到最大电压之间的值（有效值），此时等效输出电压：
$$
V = \eta V_{max}
$$
对于直流有刷电机而言，电压和转速成正比，故对应的：
$$
v = \eta v_{max}
$$
